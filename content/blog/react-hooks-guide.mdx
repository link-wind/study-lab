---
title: "React Hooks å®Œå…¨æŒ‡å—"
description: "æ·±å…¥ç†è§£ React Hooks çš„åŸç†å’Œæœ€ä½³å®è·µ"
date: "2024-02-01"
tags: ["React", "JavaScript", "å‰ç«¯", "Hooks"]
image: "/images/react-hooks.svg"
---

# React Hooks å®Œå…¨æŒ‡å—

React Hooks å½»åº•æ”¹å˜äº†æˆ‘ä»¬ç¼–å†™ React ç»„ä»¶çš„æ–¹å¼ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Hooks çš„åŸç†ã€ä½¿ç”¨æ–¹æ³•å’Œæœ€ä½³å®è·µã€‚

## ğŸ¯ ä»€ä¹ˆæ˜¯ Hooksï¼Ÿ

Hooks æ˜¯ React 16.8 å¼•å…¥çš„æ–°ç‰¹æ€§ï¼Œè®©ä½ åœ¨ä¸ç¼–å†™ç±»ç»„ä»¶çš„æƒ…å†µä¸‹ä½¿ç”¨çŠ¶æ€å’Œå…¶ä»– React ç‰¹æ€§ã€‚

```javascript
import React, { useState, useEffect } from 'react'

function Example() {
  // å£°æ˜ä¸€ä¸ªæ–°çš„çŠ¶æ€å˜é‡ï¼Œå«åš "count"
  const [count, setCount] = useState(0)

  // ç›¸å½“äº componentDidMount å’Œ componentDidUpdate:
  useEffect(() => {
    // ä½¿ç”¨æµè§ˆå™¨çš„ API æ›´æ–°é¡µé¢æ ‡é¢˜
    document.title = `You clicked ${count} times`
  })

  return (
    <div>
      <p>You clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click me
      </button>
    </div>
  )
}
```

## ğŸª åŸºç¡€ Hooks

### useState

`useState` æ˜¯ React ä¸­æœ€åŸºæœ¬çš„ Hookï¼Œç”¨äºåœ¨å‡½æ•°ç»„ä»¶ä¸­æ·»åŠ çŠ¶æ€ã€‚

```javascript
const [state, setState] = useState(initialState)
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```javascript
function Counter() {
  const [count, setCount] = useState(0)
  const [name, setName] = useState('React')

  return (
    <div>
      <p>{name} clicked {count} times</p>
      <button onClick={() => setCount(count + 1)}>
        Click
      </button>
      <button onClick={() => setName('Hooks')}>
        Change Name
      </button>
    </div>
  )
}
```

**å‡½æ•°å¼æ›´æ–°ï¼š**

```javascript
function Counter() {
  const [count, setCount] = useState(0)

  function increment() {
    setCount(prevCount => prevCount + 1)
  }

  return (
    <button onClick={increment}>
      Clicked {count} times
    </button>
  )
}
```

### useEffect

`useEffect` ç”¨äºå¤„ç†å‰¯ä½œç”¨ï¼Œç›¸å½“äºç±»ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚

```javascript
useEffect(effectFunction, dependencyArray)
```

**åŸºæœ¬ç”¨æ³•ï¼š**

```javascript
function Example() {
  const [count, setCount] = useState(0)

  // æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ
  useEffect(() => {
    document.title = `You clicked ${count} times`
  })

  // åªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡
  useEffect(() => {
    console.log('Component mounted')
  }, [])

  // ä¾èµ–ç‰¹å®šå˜é‡
  useEffect(() => {
    console.log('Count changed:', count)
  }, [count])

  return (
    <button onClick={() => setCount(count + 1)}>
      Click me
    </button>
  )
}
```

**æ¸…ç†å‡½æ•°ï¼š**

```javascript
function Timer() {
  const [seconds, setSeconds] = useState(0)

  useEffect(() => {
    const timer = setInterval(() => {
      setSeconds(s => s + 1)
    }, 1000)

    // æ¸…ç†å‡½æ•°
    return () => clearInterval(timer)
  }, [])

  return <div>Seconds: {seconds}</div>
}
```

### useContext

`useContext` è®©ä½ æ— éœ€æ˜¾å¼åœ°ä¼ é€’ propsï¼Œå°±èƒ½åœ¨ç»„ä»¶æ ‘é—´ä¼ é€’æ•°æ®ã€‚

```javascript
const value = useContext(MyContext)
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```javascript
// åˆ›å»º Context
const ThemeContext = React.createContext('light')

function App() {
  return (
    <ThemeContext.Provider value="dark">
      <Toolbar />
    </ThemeContext.Provider>
  )
}

function Toolbar() {
  return (
    <div>
      <ThemedButton />
    </div>
  )
}

function ThemedButton() {
  const theme = useContext(ThemeContext)
  return <button className={theme}>I am styled by theme context!</button>
}
```

## ğŸ”§ é¢å¤– Hooks

### useReducer

`useReducer` ç”¨äºç®¡ç†å¤æ‚çš„çŠ¶æ€é€»è¾‘ã€‚

```javascript
const [state, dispatch] = useReducer(reducer, initialArg, init)
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```javascript
function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return { count: state.count + 1 }
    case 'decrement':
      return { count: state.count - 1 }
    default:
      throw new Error()
  }
}

function Counter() {
  const [state, dispatch] = useReducer(reducer, { count: 0 })

  return (
    <>
      Count: {state.count}
      <button onClick={() => dispatch({ type: 'increment' })}>+</button>
      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>
    </>
  )
}
```

### useMemo

`useMemo` ç”¨äºæ€§èƒ½ä¼˜åŒ–ï¼Œç¼“å­˜è®¡ç®—ç»“æœã€‚

```javascript
const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b])
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```javascript
function ExpensiveComponent({ data }) {
  const processedData = useMemo(() => {
    return data.map(item => {
      // å¤æ‚çš„è®¡ç®—
      return heavyComputation(item)
    })
  }, [data])

  return <div>{processedData}</div>
}
```

### useCallback

`useCallback` ç”¨äºç¼“å­˜å‡½æ•°å¼•ç”¨ã€‚

```javascript
const memoizedCallback = useCallback(() => {
  doSomething(a, b)
}, [a, b])
```

**ä½¿ç”¨ç¤ºä¾‹ï¼š**

```javascript
function ParentComponent() {
  const [count, setCount] = useState(0)
  
  const handleClick = useCallback(() => {
    console.log('Button clicked')
  }, [])

  return (
    <div>
      <ExpensiveChildComponent onClick={handleClick} />
      <button onClick={() => setCount(count + 1)}>
        Count: {count}
      </button>
    </div>
  )
}
```

### useRef

`useRef` ç”¨äºè®¿é—® DOM å…ƒç´ æˆ–å­˜å‚¨å¯å˜å€¼ã€‚

```javascript
const refContainer = useRef(initialValue)
```

**è®¿é—® DOMï¼š**

```javascript
function TextInput() {
  const inputRef = useRef(null)

  const focusInput = () => {
    inputRef.current.focus()
  }

  return (
    <div>
      <input ref={inputRef} type="text" />
      <button onClick={focusInput}>Focus Input</button>
    </div>
  )
}
```

**å­˜å‚¨å¯å˜å€¼ï¼š**

```javascript
function Timer() {
  const [count, setCount] = useState(0)
  const intervalRef = useRef(null)

  const startTimer = () => {
    intervalRef.current = setInterval(() => {
      setCount(c => c + 1)
    }, 1000)
  }

  const stopTimer = () => {
    clearInterval(intervalRef.current)
  }

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={startTimer}>Start</button>
      <button onClick={stopTimer}>Stop</button>
    </div>
  )
}
```

## ğŸ¯ è‡ªå®šä¹‰ Hooks

è‡ªå®šä¹‰ Hooks è®©ä½ å°†ç»„ä»¶é€»è¾‘æå–åˆ°å¯é‡ç”¨çš„å‡½æ•°ä¸­ã€‚

**åˆ›å»ºè‡ªå®šä¹‰ Hookï¼š**

```javascript
function useCounter(initialValue = 0) {
  const [count, setCount] = useState(initialValue)

  const increment = useCallback(() => setCount(c => c + 1), [])
  const decrement = useCallback(() => setCount(c => c - 1), [])
  const reset = useCallback(() => setCount(initialValue), [initialValue])

  return { count, increment, decrement, reset }
}
```

**ä½¿ç”¨è‡ªå®šä¹‰ Hookï¼š**

```javascript
function Counter() {
  const { count, increment, decrement, reset } = useCounter(0)

  return (
    <div>
      <p>Count: {count}</p>
      <button onClick={increment}>+</button>
      <button onClick={decrement}>-</button>
      <button onClick={reset}>Reset</button>
    </div>
  )
}
```

**å¦ä¸€ä¸ªä¾‹å­ - useLocalStorageï¼š**

```javascript
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key)
      return item ? JSON.parse(item) : initialValue
    } catch (error) {
      return initialValue
    }
  })

  const setValue = (value) => {
    try {
      setStoredValue(value)
      window.localStorage.setItem(key, JSON.stringify(value))
    } catch (error) {
      console.error(error)
    }
  }

  return [storedValue, setValue]
}
```

## ğŸš€ æœ€ä½³å®è·µ

### 1. åªåœ¨é¡¶å±‚è°ƒç”¨ Hooks

âœ… **æ­£ç¡®ï¼š**

```javascript
function Example() {
  const [count, setCount] = useState(0)  // âœ… åœ¨é¡¶å±‚
  
  if (count > 0) {
    return <div>{count}</div>
  }
  
  return null
}
```

âŒ **é”™è¯¯ï¼š**

```javascript
function Example() {
  const [count, setCount] = useState(0)
  
  if (count > 0) {
    const [name, setName] = useState('')  // âŒ åœ¨æ¡ä»¶è¯­å¥ä¸­
    return <div>{name}</div>
  }
  
  return null
}
```

### 2. åªåœ¨ React å‡½æ•°ä¸­è°ƒç”¨ Hooks

âœ… **æ­£ç¡®ï¼š**

```javascript
function MyComponent() {
  const [value, setValue] = useState(0)
  // ...
}

function useCustomHook() {
  const [value, setValue] = useState(0)
  // ...
}
```

âŒ **é”™è¯¯ï¼š**

```javascript
function regularFunction() {
  const [value, setValue] = useState(0)  // âŒ åœ¨æ™®é€šå‡½æ•°ä¸­
  // ...
}
```

### 3. ä½¿ç”¨ ESLint æ’ä»¶

å®‰è£…å¹¶é…ç½® `eslint-plugin-react-hooks`ï¼š

```bash
npm install eslint-plugin-react-hooks --save-dev
```

```javascript
// .eslintrc
{
  "plugins": [
    "react-hooks"
  ],
  "rules": {
    "react-hooks/rules-of-hooks": "error",
    "react-hooks/exhaustive-deps": "warn"
  }
}
```

### 4. ä¼˜åŒ–ä¾èµ–æ•°ç»„

ç¡®ä¿ä¾èµ–æ•°ç»„åŒ…å«æ‰€æœ‰åœ¨ effect ä¸­ä½¿ç”¨çš„å€¼ï¼š

```javascript
function Example({ userId }) {
  const [user, setUser] = useState(null)
  
  useEffect(() => {
    fetchUser(userId).then(setUser)
  }, [userId])  // âœ… åŒ…å«äº†æ‰€æœ‰ä¾èµ–
  
  return <div>{user?.name}</div>
}
```

### 5. é¿å…è¿‡åº¦ä½¿ç”¨ useMemo å’Œ useCallback

åªåœ¨çœŸæ­£éœ€è¦ä¼˜åŒ–æ—¶æ‰ä½¿ç”¨ï¼š

```javascript
// âœ… åªåœ¨è®¡ç®—æ˜‚è´µæ—¶ä½¿ç”¨
const expensiveValue = useMemo(() => {
  return computeExpensiveValue(a, b, c)
}, [a, b, c])

// âœ… åªåœ¨éœ€è¦ç¨³å®šå¼•ç”¨æ—¶ä½¿ç”¨
const handleClick = useCallback(() => {
  doSomething(a, b)
}, [a, b])
```

## ğŸ§ª æµ‹è¯• Hooks

ä½¿ç”¨ `@testing-library/react-hooks` æµ‹è¯•è‡ªå®šä¹‰ Hooksï¼š

```bash
npm install @testing-library/react-hooks --save-dev
```

```javascript
import { renderHook, act } from '@testing-library/react-hooks'
import { useCounter } from './useCounter'

test('should increment counter', () => {
  const { result } = renderHook(() => useCounter(0))
  
  act(() => {
    result.current.increment()
  })
  
  expect(result.current.count).toBe(1)
})
```

## ğŸ“š æ€»ç»“

React Hooks ä¸ºæˆ‘ä»¬æä¾›äº†æ›´ç®€æ´ã€æ›´å¼ºå¤§çš„æ–¹å¼æ¥ç®¡ç†ç»„ä»¶çŠ¶æ€å’Œå‰¯ä½œç”¨ã€‚æŒæ¡ Hooks çš„ä½¿ç”¨å°†å¸®åŠ©ä½ å†™å‡ºæ›´å¥½çš„ React åº”ç”¨ã€‚

### å…³é”®ç‚¹å›é¡¾ï¼š

1. **useState**: ç®¡ç†ç»„ä»¶çŠ¶æ€
2. **useEffect**: å¤„ç†å‰¯ä½œç”¨
3. **useContext**: è·¨ç»„ä»¶ä¼ é€’æ•°æ®
4. **useReducer**: ç®¡ç†å¤æ‚çŠ¶æ€
5. **useMemo/useCallback**: æ€§èƒ½ä¼˜åŒ–
6. **useRef**: è®¿é—® DOM å’Œå­˜å‚¨å¯å˜å€¼
7. **è‡ªå®šä¹‰ Hooks**: æå–å’Œå¤ç”¨é€»è¾‘

è®°ä½ Hooks çš„è§„åˆ™ï¼Œéµå¾ªæœ€ä½³å®è·µï¼Œä½ çš„ React ä»£ç å°†å˜å¾—æ›´åŠ ä¼˜é›…å’Œé«˜æ•ˆï¼

---

> æƒ³è¦äº†è§£æ›´å¤š React Hooks çš„é«˜çº§ç”¨æ³•ï¼Ÿç»§ç»­å…³æ³¨ StudyLab çš„åç»­æ–‡ç« ï¼

å‚è€ƒèµ„æ–™ï¼š
- [React Hooks å®˜æ–¹æ–‡æ¡£](https://reactjs.org/docs/hooks-intro.html)
- [Hooks FAQ](https://reactjs.org/docs/hooks-faq.html)
- [ä½¿ç”¨ Hooks çš„åŠ¨æœº](https://reactjs.org/docs/hooks-intro.html#motivation)